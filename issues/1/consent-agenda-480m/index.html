<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Consent Agenda That Moved $480M · Corridor Ledger</title>
  <link rel="stylesheet" href="/main.css" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Scoped tweaks for the comments UI -->
  <style>
    /* Form tile: keep your hero style, but align contents left */
    .comments-hero.hero { text-align: left; }

    /* Labels/fields: crisp, form-like, aligned to tile edge */
    .comment-form {
      display: grid;
      gap: 12px;
      margin-top: 10px;     /* close to the card’s inner edge */
      width: 100%;
      max-width: 820px;     /* roomy but not too wide */
    }
    .comment-form label {
      display: grid;
      gap: 6px;
      font-weight: 600;
      color: var(--ink);
    }
    .comment-form input[type="text"],
    .comment-form input[type="email"],
    .comment-form input[type="url"],
    .comment-form textarea {
      width: 100%;
      padding: .7rem .9rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--paper);
      color: var(--ink);
      font: inherit;
      line-height: 1.4;
    }
    .comment-form textarea { resize: vertical; min-height: 132px; }

    /* Focus: subtle but accessible */
    .comment-form input:focus,
    .comment-form textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 18%, transparent);
    }

    /* Submit button: mimic nav tiles (gentle grow + bolder on hover) */
    .btn-nav {
      display: inline-block;
      align-self: start;          /* left-align under fields */
      padding: .65rem 1rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--paper);
      color: var(--ink);
      text-decoration: none;
      font-weight: 600;
      transition: transform .09s ease, background-color .15s ease, color .15s ease, border-color .15s ease, box-shadow .15s ease;
      cursor: pointer;
    }
    .btn-nav:hover {
      transform: scale(1.015);
      font-weight: 700;
      border-color: var(--accent);
      color: var(--ink);
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
    }
    .btn-nav:active { transform: scale(0.995); }

    /* Success note */
    #comment-submitted {
      display: none;
      margin-bottom: 10px;
      padding: .6rem .8rem;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--paper);
      color: var(--ink);
    }

    /* Rendered comments list: cleaner cards */
    #comments {
      list-style: none;
      padding: 0;
      margin: 18px 0 0;
      display: grid;
      gap: 12px;
    }
    .comment-item {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--paper);
      padding: 12px;
    }
    .comment-item .who { font-weight: 700; }
    .comment-item .when { color: var(--muted); font-size: .85rem; }
    .comment-item .what { margin-top: 6px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="brand">
      <button class="icon-btn menu-btn" id="menuToggle" aria-label="Open menu" aria-expanded="false" aria-controls="dropdown">☰</button>
      <a href="/" class="logo-link" aria-label="Corridor Ledger home">
        <img src="/wordmark_header_1200w.png" class="wordmark wordmark-light" alt="Corridor Ledger" />
        <img src="/wordmark_header_dark_1200w.png" class="wordmark wordmark-dark" alt="Corridor Ledger" />
      </a>
      <button class="icon-btn theme-btn" id="themeToggle" aria-label="Toggle dark mode">
        <img src="/sun_grunge_black_transparent.png" class="theme-icon theme-icon-sun" alt="" />
        <img src="/moon_grunge_white_transparent.png" class="theme-icon theme-icon-moon" alt="" />
      </button>
    </div>

    <nav class="nav desktop-nav" aria-label="Primary">
      <a href="/">Home</a>
      <a href="/mechanisms/">Mechanisms</a>
      <a href="/figures/">Figures</a>
      <a href="/numbers/">Numbers</a>
      <a href="/dossiers/">Dossiers</a>
      <a href="/tips/">Tips</a>
    </nav>

    <div class="dropdown" id="dropdown" aria-hidden="true">
      <form class="dropdown-search" onsubmit="return false" role="search">
        <input class="search-input" type="search" placeholder="Search Corridor Ledger" />
      </form>
      <nav class="dropdown-nav">
        <a href="/" data-route="/">Home</a>
        <a href="/mechanisms/" data-route="/mechanisms/">Mechanisms</a>
        <a href="/figures/" data-route="/figures/">Figures</a>
        <a href="/numbers/" data-route="/numbers/">Numbers</a>
        <a href="/dossiers/" data-route="/dossiers/">Dossiers</a>
        <a href="/tips/" data-route="/tips/">Tips</a>
      </nav>
    </div>
    <div class="dropdown-backdrop" id="backdrop" aria-hidden="true"></div>
  </header>

  <main class="container">
    <section class="rail">
      <article class="hero hero-center">
        <h1 class="headline">The Consent Agenda That Moved $480M</h1>
        <p class="dek">A one-page renewal inside a 214-page packet—and the vote that followed.</p>
      </article>
    </section>

    <!-- Article body placeholder -->
    <section class="rail">
      <article class="hero">
        <p class="muted">[Your story goes here.]</p>
      </article>
    </section>

    <!-- Comments -->
    <section class="rail">
      <article class="hero comments-hero">
        <h2 style="margin-top:0">Comments</h2>

        <!-- Submission success -->
        <div id="comment-submitted">Thanks — your comment was submitted. If moderation is enabled, it will appear after review.</div>

        <!-- Comment form -->
        <form
          action="https://cl-comments.3wh.workers.dev"
          method="POST"
          class="comment-form">

          <input type="hidden" name="options[slug]" value="consent-agenda-480m">
          <input type="hidden" name="options[redirect]" value="https://www.corridorledger.com/issues/1/consent-agenda-480m/#comment-submitted">

          <!-- Honeypot (keep empty) -->
          <div style="position:absolute;left:-5000px" aria-hidden="true">
            <label>Leave this field empty
              <input type="text" name="fields[website]" tabindex="-1" autocomplete="off">
            </label>
          </div>

          <label>Name
            <input required name="fields[name]" type="text" placeholder="Your name">
          </label>

          <label>Website (optional)
            <input name="fields[url]" type="url" placeholder="https://">
          </label>

          <label>Comment
            <textarea required name="fields[message]" rows="6" placeholder="Add your comment…"></textarea>
          </label>

          <button class="btn-nav" type="submit">Post comment</button>
          <p class="muted" style="margin:.25rem 0 0">No login required. Basic spam checks apply.</p>
        </form>

        <!-- Rendered comments -->
        <ul id="comments"></ul>
      </article>
    </section>
  </main>

  <footer class="site-footer">
    <div class="foot-left">
      <a href="/feed.xml">RSS</a> · <a href="/corrections/">Corrections</a> ·
      <a href="mailto:editor@corridorledger.com">Editor</a> · <a href="/tips/">Tips</a>
    </div>
    <div class="foot-right">© 2025 Corridor Ledger</div>
  </footer>

  <script>
    // ----- shared UI (menu + theme) -----
    const menuToggle=document.getElementById('menuToggle');
    const dropdown=document.getElementById('dropdown');
    const backdrop=document.getElementById('backdrop');
    const themeToggle=document.getElementById('themeToggle');
    const root=document.documentElement;

    function openDropdown(open){
      dropdown.classList.toggle('open',open);
      backdrop.classList.toggle('show',open);
      menuToggle?.setAttribute('aria-expanded',open?'true':'false');
      dropdown?.setAttribute('aria-hidden',open?'false':'true');
      document.body.classList.toggle('no-scroll',open);
      if(open){ markActive(); dropdown.querySelector('.search-input')?.focus(); }
    }
    menuToggle?.addEventListener('click',()=>openDropdown(!dropdown.classList.contains('open')));
    backdrop?.addEventListener('click',()=>openDropdown(false));
    document.addEventListener('keydown',e=>{ if(e.key==='Escape') openDropdown(false); });
    dropdown?.addEventListener('click',e=>{ if(e.target.tagName==='A') openDropdown(false); });

    function markActive(){
      const path=(location.pathname.replace(/\/+$/,'/')||'/');
      document.querySelectorAll('.dropdown-nav [data-route]').forEach(a=>{
        const r=a.getAttribute('data-route');
        a.classList.toggle('active', (r==='/'&&path==='/') || (r!=='/'&&path.startsWith(r)));
      });
    }

    (function initTheme(){
      const saved=localStorage.getItem('cl-theme');
      if(saved==='dark'||saved==='light'){ root.setAttribute('data-theme',saved); }
      else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
        root.setAttribute('data-theme','dark');
      }
    })();
    themeToggle?.addEventListener('click',()=>{
      const next=root.getAttribute('data-theme')==='dark'?'light':'dark';
      root.setAttribute('data-theme',next); localStorage.setItem('cl-theme',next);
    });

    // show success message after redirect anchor
    if (location.hash === '#comment-submitted') {
      const el = document.getElementById('comment-submitted');
      if (el) el.style.display = 'block';
    }

    // ----- Comments loader (reads merged JSON files) -----
    (async function loadComments(){
      const OWNER='CorridorLedger';
      const REPO='corridorledger-site';
      const SLUG='consent-agenda-480m';
      const BRANCH='main'; // default branch

      const listUrl=`https://api.github.com/repos/${OWNER}/${REPO}/contents/comments/${SLUG}?ref=${BRANCH}`;
      const out=document.getElementById('comments');
      if(!out) return;

      try{
        const res=await fetch(listUrl, { headers:{ 'Accept':'application/vnd.github+json' }});
        if(!res.ok){ return; } // no comments yet
        const items=await res.json();
        items.sort((a,b)=>b.name.localeCompare(a.name)); // newest first

        for(const file of items){
          if(file.type!=='file') continue;
          const jr=await fetch(file.download_url);
          const j=await jr.json();

          const li=document.createElement('li');
          li.className='comment-item';
          li.innerHTML=`
            <div class="who">${escapeHtml(j.name || 'Reader')}</div>
            <div class="when">${formatWhen(j.date)}</div>
            <div class="what">${escapeHtml(j.message || '')}</div>
          `;
          out.appendChild(li);
        }
      }catch(e){ console.warn('comments load failed', e); }

      function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
      function formatWhen(iso){ try{ return new Date(iso).toLocaleString(); }catch{ return ''; } }
    })();
  </script>
</body>
</html>
